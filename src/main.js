// Generated by CoffeeScript 1.10.0
(function() {
  var automaton_for, clear_grid, load_automaton_for, load_color_rule, load_color_rules, set_up_controls_for;

  this.load_rule = function(rule) {
    clear_grid();
    load_color_rules(rule.colors);
    return load_automaton_for(rule);
  };

  load_color_rules = function(color_rules) {
    jQuery('style').remove();
    return _.each(color_rules, function(color, state) {
      return load_color_rule(state, color);
    });
  };

  clear_grid = function() {
    return jQuery('#grid_container').empty();
  };

  load_automaton_for = function(rule) {
    var automaton;
    automaton = automaton_for(rule);
    return set_up_controls_for(automaton);
  };

  automaton_for = function(rule) {
    var automaton, grid;
    grid = new Grid(jQuery('#grid_container'), {
      height: 30,
      width: 50,
      interactive: true,
      states: rule.states
    });
    return automaton = new Automaton(grid, rule.rule, 100);
  };

  set_up_controls_for = function(automaton) {
    jQuery('#start').off();
    jQuery('#stop').off();
    jQuery('#step').off();
    jQuery('#clear').off();
    jQuery('#start').click(function() {
      return automaton.start();
    });
    jQuery('#stop').click(function() {
      return automaton.stop();
    });
    jQuery('#step').click(function() {
      return automaton.step();
    });
    return jQuery('#clear').click(function() {
      return automaton.clear();
    });
  };

  load_color_rule = function(state, color) {
    return jQuery("<style>[data-state='" + state + "'] { background-color: " + color + "; }</style>").appendTo('head');
  };

  this.display_menu = function() {
    var menu;
    menu = jQuery('<select/>', {
      id: 'menu'
    });
    _.each(_.keys(this.rules), function(rule_name) {
      return menu.append(jQuery('<option/>', {
        value: rule_name,
        text: this.rules[rule_name].name
      }));
    });
    menu.change((function(_this) {
      return function() {
        return _this.load_rule(_this.rules[menu.val()]);
      };
    })(this));
    return jQuery('#controls').append(menu);
  };

  $((function(_this) {
    return function() {
      _this.display_menu();
      return _this.load_rule(_this.rules.conways_game_of_life);
    };
  })(this));

}).call(this);
